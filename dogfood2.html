<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>可编辑海报生成器</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @font-face {
        font-family: 'jinghualaosongtiV2';
        src: url('https://raw.githubusercontent.com/airbai/surgefiles/main/jinghualaosongtiV2.002.ttf') format('truetype'),
         url('https://raw.githubusercontent.com/airbai/surgefiles/main/jinghualaosongtiV2.002.ttf') format('woff'),
         url('https://raw.githubusercontent.com/airbai/surgefiles/main/jinghualaosongtiV2.002.ttf') format('woff2');
            font-weight: normal;
            font-style: normal;
}
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }

        body::after {
            content: 'Fiit.AI出品';
            font-family: 'jinghualaosongtiV2', sans-serif;
            position: fixed;
            top: 10px;
            left: 10px;
            background: white;
            border: 1px solid black;
            z-index: 9999;
            font-size:xx-large;
        }

        #poster {
            font-family: 'jinghualaosongtiV2', sans-serif;
            width: 360px;
            height: 779px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            position: relative;
            background-image: linear-gradient(to bottom, #ffffff, #a8e6cf), url('design-space-paper-textured-background_53876-147801 (1).jpg');
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center center;
            background-blend-mode: multiply; /* 调整混合模式 */
        }

/*
        #poster {
            font-family: 'jinghualaosongtiV2', sans-serif;
            width: 540px;
            height: 1168.5px;
            background: linear-gradient(to bottom, #ffffff, #a8e6cf);
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            position: relative;
            background: url('design-space-paper-textured-background_53876-147801 (1).jpg') no-repeat center center; 
            background-size: cover;
        }



        #poster {
    font-family: 'jinghualaosongtiV2', sans-serif;
    width: 540px;
    height: 1168.5px;
    background: linear-gradient(to bottom, #ffffff, #a8e6cf);

    box-shadow: 0 0 10px rgba(0,0,0,0.1), 0 0 20px rgba(0,0,0,0.1) inset; 
    border: 1px solid rgba(0, 0, 0, 0.1);
    position: relative;
    padding: 20px;
    background: linear-gradient(to bottom, #ffffff 0%, #f1e6d2 100%);
    border-radius: 10px;
}*/


        .editable {
            border: none;
            background: transparent;
            position: absolute;
            width: 90%;
            left: 5%;

            font-family: 'jinghualaosongtiV2', sans-serif;

            word-wrap: break-word;
            overflow-wrap: break-word;
            word-break: break-word;
        }
        .small-text { 
            font-size: 12px; 
            font-family: 'jinghualaosongtiV2', sans-serif;
        }

        .x-medium-text { 
            font-size: 15px; 
            font-family: 'jinghualaosongtiV2', sans-serif;
        }

        .xx-medium-text { 
            font-size: 24px; 
            font-family: 'jinghualaosongtiV2', sans-serif;
        }

        .medium-text { 
            font-size: 30px; 
            font-family: 'jinghualaosongtiV2', sans-serif;
        }
        .large-text { 
            font-size: 45px; 
            font-weight: bold; 
            font-family: 'jinghualaosongtiV2', sans-serif;
        }

        .group6 input
        {
            text-align: right;
        }

        #saveButton {
            margin-top: 20px;
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }

        #controls {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            margin-top: 20px;
        }

        #topic {
            margin-bottom: 10px;
            padding: 5px;
            width: 345px;
            text-align: left;
        }

        #changeThemeButton {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }

        @keyframes bounce {
    0%, 100% {
        transform: scale(1);
    }
    25% {
        transform: scale(0.9);
    }
    50% {
        transform: scale(1.1);
    }
    75% {
        transform: scale(0.95);
    }
}

.dough-ball {
    width: 100px; /* 根据需要设置尺寸 */
    height: 100px; /* 根据需要设置尺寸 */
    background-color: #ffd700; /* 金色，类似面团的颜色 */
    border-radius: 50%; /* 圆形 */
    animation: bounce 2s infinite ease-in-out; /* 应用动画 */
}
    </style>
</head>
<body>
    <div><div id="poster">
        <div class="group1">
        <input type="text" class="editable small-text" value="房价下跌这个概念" style="top: 2%;">
        <input type="text" class="editable small-text" value="也值得思考" style="top: 6%;">
        <input type="text" class="editable small-text" value="为什么你的房子也跌了呢" style="top: 10%;">
        <input type="text" class="editable small-text" value="这个世界上很多人都在抱怨房价下跌影响了资产" style="top: 14%;">
        <input type="text" class="editable small-text" value="影响了生活质量" style="top: 18%;">
        <input type="text" class="editable small-text" value="对着市场指手画脚" style="top: 22%;">
        <input type="text" class="editable small-text" value="对着政策好为人师" style="top: 26%;">
        <input type="text" class="editable small-text" value="很多人都没有意识到" style="top: 30%;">
        <input type="text" class="editable small-text" value="这是大环境的影响" style="top: 34%;">
        <input type="text" class="editable small-text" value="你准备怎么应对了" style="top: 38%;">
        <input type="text" class="editable small-text" value="什么是正确的态度" style="top: 42%;">
        </div>
        <div class="group2" style="left: 30%;">
        <input type="text" class="editable medium-text" value="不要把大环境" style="top: 28%;left: 40%;">
        <input type="text" class="editable medium-text" value="的错揽到" style="top: 33%;left: 40%;">
        <input type="text" class="editable medium-text" value="自己身上去" style="top: 38%;left: 40%;">
        </div>
        <div class="group3">
        <input type="text" class="editable large-text" value="调整心态很重要" style="top: 49%;">
        </div>
        <div class="group4">
        <input type="text" class="editable medium-text" value="别想着房价马上回升" style="top: 60%;">
        <input type="text" class="editable medium-text" value="别想着一夜暴富了" style="top: 64%;">
        </div>
        <div class="group5">
        <input type="text" class="editable x-medium-text" value="涨了也不会怎么样" style="top: 73%;">
        <input type="text" class="editable x-medium-text" value="跌了也还有其他投资机会" style="top: 76%;">
        <input type="text" class="editable x-medium-text" value="保持良好的心态" style="top: 79%;">
        <input type="text" class="editable x-medium-text" value="好好" style="top: 82%; width: auto;">
        <input type="text" class="editable x-medium-text" value="锻炼" style="top: 85%; width: auto;">
        <input type="text" class="editable x-medium-text" value="保持身心愉悦" style="top: 88%; width: auto;">
        </div>
        <div class="group6">
        <input type="text" class="editable small-text" value="你的房子跌价只是暂时的市场调整" style="top: 91%; ">
        <input type="text" class="editable small-text" value="你不要太过担心焦虑" style="top: 93%;">
        <input type="text" class="editable small-text" value="下一个周期来临时房价可能会比现在更高更有价值" style="top: 95%;">
        <input type="text" class="editable small-text" value="那现在调整心态的人，为什么不能是你呢" style="top: 97%;">
        </div>
    </div>

    <div id="controls">
        <input type="text" class="small-text" id="topic" maxlength="20" placeholder="输入话题，20个字以内">
        <button id="changeThemeButton" class="x-medium-text">换个这个话题</button>
    </div>
    </div>
    <script>
        /*
function loadImage(url, callback) {
    var img = new Image();
    img.crossOrigin = 'anonymous'; // 允许跨域访问
    img.onload = function() {
        var canvas = document.createElement('canvas');
        var ctx = canvas.getContext('2d');
        canvas.width = img.width;
        canvas.height = img.height;
        ctx.drawImage(img, 0, 0);
        callback(canvas);
    };
    img.src = url;
}

function saveCanvas() {
    loadImage('design-space-paper-textured-background_53876-147801 (1).jpg', function(canvas) {
        html2canvas(canvas).then(function(canvas) {
            var link = document.createElement('a');
            link.download = 'poster.png';
            link.href = canvas.toDataURL();
            link.click();
        });
    });
}

document.getElementById('saveButton').addEventListener('click', saveCanvas);*/
document.getElementById('changeThemeButton').addEventListener('click', changeTheme);

async function changeTheme() {
    const button = document.getElementById('changeThemeButton');
    const apiKey = ''; 
    const apiUrl = 'https://api.openai.com/v1/chat/completions';

    const topic = document.getElementById('topic').value.trim() || "调整心态";

    // 获取所有输入框
    const inputs = document.querySelectorAll('#poster input[type="text"]');
    
    // 准备提示信息
    const prompt = `
    请为以下主题提供新的文本内容：
    "${topic}"
    要求：
    1. 提供与上述主题相关的，且伍迪艾伦风格的短句。
    2. 必须提供 ${inputs.length} 个短句，与当前海报中的输入框数量相同。
    3. 每个短句的字符数必须与当前海报中对应的输入框内容字符数相同。
    4. 其中第15个的短句一定要更新为和${topic}相关。
    5. 以下是当前每个输入框的内容和字符数，请严格按照这个格式和字符数提供新的内容：
    ${Array.from(inputs).map((input, index) => `${index + 1}. ${input.value} `).join('\n')}
    `;

    // 禁用按钮并开始 "思考" 动画
    button.disabled = true;
    startThinkingAnimation(button);

    try {
        // 调用 GPT-4 API
        const response = await fetch(apiUrl, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${apiKey}`
            },
            body: JSON.stringify({
                model: 'gpt-4o-mini',
                messages: [{ role: 'user', content: prompt }],
                temperature: 1
            })
        });

        if (!response.ok) {
            throw new Error('API 请求失败');
        }

        const data = await response.json();
        const newValues = data.choices[0].message.content.split('\n').filter(line => line.trim() !== '');

        
        // 停止 "思考" 动画，开始 "装修" 动画
        stopThinkingAnimation(button);
        startRenovatingAnimation(button);

        // 更新 HTML 中的 input 值，使用流式效果
        for (let index = 0; index < inputs.length; index++) {
            if (index < newValues.length) {
                const input = inputs[index];
                // 提取新值，去掉序号和字符数信息
                const newValue = newValues[index].replace(/^\d+\.\s*/, '').replace(/\s*\(\d+字\)$/, '');
                // 确保新值的长度与原始值相同，如果不同则截取
                const finalValue = newValue.length === input.value.length ? newValue : newValue.substring(0, input.value.length);
                
                // 使用流式效果更新 input 值
                await streamText(input, finalValue);

                if (newValue.length !== input.value.length) {
                    console.warn(`第 ${index + 1} 个输入框的新值长度不匹配，已截取新值以匹配原长度。`);
                }
            }
        }

        // 停止 "装修" 动画，显示 "装修完成"
        stopRenovatingAnimation(button);
        showCompletionMessage(button);

    } catch (error) {
        console.error('更新海报主题时出错:', error);
        button.textContent = '换个这个话题';
        button.disabled = false;
    }

    // 流式文本展示函数
async function streamText(input, text) {
    let index = 0;
    return new Promise(resolve => {
        const intervalId = setInterval(() => {
            if (index < text.length) {
                input.value = text.slice(0, index + 1);
                index++;
            } else {
                clearInterval(intervalId);
                resolve();
            }
        }, 50); // 可以调整这个值来改变流式效果的速度
    });
}
}

function startThinkingAnimation(button) {
    button.textContent = 'AI 在思考了......';
    button.style.animation = 'breathe 2s infinite';
}

function stopThinkingAnimation(button) {
    button.style.animation = 'none';
}

function startRenovatingAnimation(button) {
    button.textContent = 'AI 在装修海报中了......';
    button.style.animation = 'breathe 2s infinite';
}

function stopRenovatingAnimation(button) {
    button.style.animation = 'none';
}

function showCompletionMessage(button) {
    button.textContent = '新海报完成';
    setTimeout(() => {
        button.textContent = '换个这个话题';
        button.disabled = false;
    }, 3000);
}

// 添加呼吸效果的 CSS
const style = document.createElement('style');
style.textContent = `
@keyframes breathe {
    0% { transform: scale(1); }
    50% { transform: scale(3); }
    100% { transform: scale(1); }
}
`;
document.head.appendChild(style);
    </script>
</body>
</html>